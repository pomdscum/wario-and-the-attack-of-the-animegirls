<!doctype html>

<body>
    <canvas id="gameCanvas" width="1200" height="800"></canvas>
    <script>
        var canvas, canvasContext;
        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            setInterval(mainloop, 1000 / 50);
        }
         //player variables
        const PLAYER_SIZE = 100;
        var playerXpos = 280;
        var playerYpos = 560;
        var playerXspeed = 5;
        var playerYspeed = 5;
        var yVel = 0;
        var jumping = false;
        var bird = new Image();
        bird.src = 'bunga.png'
        var groundY = 200;

        var spaceKeyPressed = false;

        const SPACE_BAR = 32;
        
    //Pipe vars
        var Pipes = [];
        var settingUp = true;
        var totalPipes = 5;

        
        var back = new Image();
        back.src = 'back.jfif';

        function mainloop() {
            if(settingUp){
               setUp();
                settingUp = false;
            }
            
//            colorRect(0, 0, canvas.width, canvas.height, 'darkgrey'); // bg     // canvas color
            drawImg(back,0,0,canvas.width,canvas.height);
//            drawImg(bird,playerXpos, playerYpos, PLAYER_SIZE, PLAYER_SIZE, 'yellow'); // bg //player size

            PlayerMove();
            DrawPipes();
            movePipes();
            
        }

        function drawImg(src,x,y,w,h){
            canvasContext.drawImage(src,x,y,w,h); 
        }
        
        
        
        
        function keyPressed(evt) {
            if (evt.keyCode == SPACE_BAR) {
                spaceKeyPressed = true;
                jumping = true;
            }
        }


        function keyReleased(evt) {
            if (evt.keyCode == SPACE_BAR) {
                spaceKeyPressed = false;
            }
        }

        function PlayerMove() {
            if (spaceKeyPressed) {
                yVel = 8;
            } 
            if (jumping) {

                playerYpos -= yVel;
                yVel -= 0.3;

                if (playerYpos + PLAYER_SIZE > canvas.height - groundY) {
                    yVel = 0;
                    playerYpos = canvas.height - groundY - PLAYER_SIZE;
                    jumping = false;
                }
            }

        }

        function setUp() {
            for(var i = 0; i < totalPipes; i++){
                
            var PipeWidth = 80;
            var PipeHeight = 350;
            var PipeGap = Math.floor(Math.random() * (100 - 40)) + 40;  
            var PipeOrigin = Math.floor(Math.random() * ((canvas.height * .7)-(canvas.height * .3)) )+ canvas.height * .3;  
            var PipeXpos = canvas.width + i * (PipeWidth * 3);
            
            var PipeYpos = 0;
            if(i%2 == 0 || i == 0){
                PipeYpos = PipeOrigin - PipeHeight - PipeGap / 2;
            } else {
                PipeYpos = PipeOrigin + PipeGap / 2;
            }
            var PipeXspeed = 7;



            var Pipe = {
                PipeXpos: PipeXpos,
                PipeYpos: PipeYpos,
                PipeWidth: PipeWidth,
                PipeHeight: PipeHeight,
                PipeXspeed: PipeXspeed
            }



            Pipes.push(Pipe);

            }


        } // end func 
        function DrawPipes() {
            Pipes.forEach(function(Pipe, i) {
                colorRect(Pipe.PipeXpos, Pipe.PipeYpos, Pipe.PipeWidth, Pipe.PipeHeight, 'cyan');
            });
        }

        function movePipes() {
            Pipes.forEach(function(Pipe, i) {
                Pipe.PipeXpos -= Pipe.PipeXspeed;
                console.log(Pipe.PipeXpos)
            });
        }


//        function PipeRandomSpawns() {
//            math.random() * canvas.width
//        };



//        function movePipes() {
//            Pipes.forEach(function(Pipe, i) {
//                Pipe.PipeXpos += Pipe.PipeXspeed; // move x
//                Pipe.PipeYpos += Pipe.PipeYspeed; // move y
//
//
//
//                //Right edge bounce
//                if (Pipe.PipeXpos + Pipe.PipeSize > canvas.width) {
//                    Pipe.PipeXspeed *= -1;
//
//
//
//                }
//
//
//
//                //Left Edge Bounce
//                if (Pipe.PipeXpos < 0) {
//                    Pipe.PipeXspeed *= -1;
//                }
//
//
//
//                if (Pipe.PipeYpos > canvas.height) {
//                    Pipe.PipeYpos = 0 - Pipe.PipeSize;
//                    Pipe.PipeSize = Math.floor(Math.random() * (80 - 20)) + 10;
//                    Pipe.PipeYspeed = Math.floor(Math.random() * (10 - 1)) + 1;
//                    Pipe.PipeXspeed = Math.floor(Math.random() * (10 - 1)) + 1;
//
//
//
//                }
//                if (Pipe.PipeYpos + Pipe.PipeSize > PlayerYpos && Pipe.PipeYpos < PlayerYpos + PLAYER_SIZE && Pipe.PipeXpos + Pipe.PipeSize > PlayerXpos && Pipe.PipeXpos < PlayerXpos + PLAYER_SIZE) {
//                    PlayerXpos = 100;
//                    PlayerYpos = canvas.height - PLAYER_SIZE;
//                    Health--;
//                    console.log('Health:' + Health);
//                }
//            });
//        } //end func


        function colorRect(x, y, w, h, c) {
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        }
        


    </script>
</body>
