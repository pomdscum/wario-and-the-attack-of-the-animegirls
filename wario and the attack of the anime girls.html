<!doctype html>

<body>
    <canvas id="gameCanvas" width="1200" height="800"></canvas>
    <script>
        var canvas, canvasContext;
        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            setInterval(mainloop, 1000 / 50);
        }
         //player variables
        const PLAYER_SIZE = 100;
        var playerXpos = 280;
        var playerYpos = 560;
        var playerXspeed = 5;
        var playerYspeed = 5;
        var yVel = 0;
        var jumping = false;
        var bird = new Image();
        bird.src = 'bunga.png'
        var groundY = 200;

        var spaceKeyPressed = false;

        const SPACE_BAR = 32;
        
    //enemy vars
        var Enemys = [];
        var settingUp = true;
        var totalEnemys = 5;

        
        var back = new Image();
        back.src = 'back.jfif';

        function mainloop() {
            if(settingUp){
               setUp();
                settingUp = false;
            }
            
            colorRect(0, 0, canvas.width, canvas.height, 'darkgrey'); // bg     // canvas color
            drawImg(back,0,0,canvas.width,canvas.height);
            drawImg(bird,playerXpos, playerYpos, PLAYER_SIZE, PLAYER_SIZE, 'yellow'); // bg //player size

            PlayerMove();
            DrawEnemys();
            
        }

        function drawImg(src,x,y,w,h){
            canvasContext.drawImage(src,x,y,w,h); 
        }
        
        
        
        
        function keyPressed(evt) {
            if (evt.keyCode == SPACE_BAR) {
                spaceKeyPressed = true;
                jumping = true;
            }
        }


        function keyReleased(evt) {
            if (evt.keyCode == SPACE_BAR) {
                spaceKeyPressed = false;
            }
        }

        function PlayerMove() {
            if (spaceKeyPressed) {
                yVel = 8;
            }
            if (jumping) {

                playerYpos -= yVel;
                yVel -= 0.3;

                if (playerYpos + PLAYER_SIZE > canvas.height - groundY) {
                    yVel = 0;
                    playerYpos = canvas.height - groundY - PLAYER_SIZE;
                    jumping = false;
                }
            }

        }

        function setUp() {
            for(var i = 0; i < totalEnemys; i++){
                
            var EnemySize = Math.floor(Math.random() * (100 - 10)) + 10;
            var EnemyXpos = Math.floor(Math.random() * ((canvas.width - EnemySize) - 0)) + 0;
            var EnemyYpos = Math.floor(Math.random() * ((canvas.height - EnemySize) - 0)) + 0;
            var EnemyYspeed = Math.floor(Math.random() * (10 - 1)) + 1;
            var EnemyXspeed = Math.floor(Math.random() * (10 - 1)) + 1;



            var Enemy = {
                EnemyXpos: EnemyXpos,
                EnemyYpos: EnemyYpos,
                EnemySize: EnemySize,
                EnemyXspeed: EnemyXspeed,
                EnemyYspeed: EnemyYspeed,
            }



            Enemys.push(Enemy);

            }


        } // end func 
        function DrawEnemys() {
            Enemys.forEach(function(Enemy, i) {
                colorRect(Enemy.EnemyXpos, Enemy.EnemyYpos, Enemy.EnemySize, Enemy.EnemySize, 'cyan');
            });
        }



//        function EnemyRandomSpawns() {
//            math.random() * canvas.width
//        };



        function moveEnemys() {
            Enemys.forEach(function(Enemy, i) {
                Enemy.EnemyXpos += Enemy.EnemyXspeed; // move x
                Enemy.EnemyYpos += Enemy.EnemyYspeed; // move y



                //Right edge bounce
                if (Enemy.EnemyXpos + Enemy.EnemySize > canvas.width) {
                    Enemy.EnemyXspeed *= -1;



                }



                //Left Edge Bounce
                if (Enemy.EnemyXpos < 0) {
                    Enemy.EnemyXspeed *= -1;
                }



                if (Enemy.EnemyYpos > canvas.height) {
                    Enemy.EnemyYpos = 0 - Enemy.EnemySize;
                    Enemy.EnemySize = Math.floor(Math.random() * (80 - 20)) + 10;
                    Enemy.EnemyYspeed = Math.floor(Math.random() * (10 - 1)) + 1;
                    Enemy.EnemyXspeed = Math.floor(Math.random() * (10 - 1)) + 1;



                }
                if (Enemy.EnemyYpos + Enemy.EnemySize > PlayerYpos && Enemy.EnemyYpos < PlayerYpos + PLAYER_SIZE && Enemy.EnemyXpos + Enemy.EnemySize > PlayerXpos && Enemy.EnemyXpos < PlayerXpos + PLAYER_SIZE) {
                    PlayerXpos = 100;
                    PlayerYpos = canvas.height - PLAYER_SIZE;
                    Health--;
                    console.log('Health:' + Health);
                }
            });
        } //end func


        function colorRect(x, y, w, h, c) {
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        }
        


    </script>
</body>
